global.SML=METHOD(function(){"use strict";var t=function(n,i,e){var o,r,u="",s="",c=0,a=function(n){var r,c,a=0,m="",E="",d=[];EACH(n,function(t){return"\t"===t&&void(a+=1)}),""!==n.trim()&&(a===i?(n=n.trim(),"#"!==n[0]&&(""!==s?void 0!==o?(u+=">\n"+t(s,i+1,e),s="",REPEAT(i+e+1,function(){u+="\t"}),u+="</"+o+">\n",o=void 0):(u+=t(s,i+1,e-1),s="",REPEAT(i+e-1,function(){u+="\t"})):void 0!==o&&"'"!==o&&(u+="meta"===o||"link"===o||"br"===o?">\n":"script"===o?"></script>\n":" />\n"),REPEAT(i+e+1,function(){u+="\t"}),"'"===n[0]?(o="'",r=n):(o="",EACH(n,function(t,i){return" "===t||"\t"===t?(r=n.substring(i),!1):void("#"===t||"."===t?(""!==E&&(d.push(E),E=""),c=t):"#"===c?m+=t:"."===c?E+=t:o+=t)}),""!==E&&(d.push(E),E=""),u+="<"+o),d.length>0&&(r=" class='"+RUN(function(){var t="";return EACH(d,function(n,i){i>0&&(t+=" "),t+=n}),t})+"'"+(void 0===r?"":r)),""!==m&&(r=" id='"+m+"'"+(void 0===r?"":r)),void 0!==r&&RUN(function(){var t,n="",s="",c="",a=0;EACH(r,function(u,m){"'"===u&&"\\"!==r[m-1]?t===!0?(""===c.trim()?s+=RUN(function(){var t=r.substring(a+1,m),n="",o=i+1;return EACH(t,function(r,u){o!==-1&&("\t"===r?(o+=1,o===i+2&&(o=-1)):o=-1),o===-1&&("\r"===r||"\\"===r&&"'"===t[u+1]||("\n"===r?(""!==n&&""!==t.substring(u).trim()&&(n+="<br>"),n+="\n",REPEAT(o+e+2,function(){n+="\t"}),o=i+1):n+=r))}),n}):"meta"===o?(c=c.trim(),c=c.substring(0,c.length-1),n+=' name="'+c+'" content="'+r.substring(a+1,m)+'"'):n+=c+'"'+r.substring(a+1,m)+'"',c="",t=!1):t=!0:t!==!0&&(c+=u,a=m+1)}),t===!0&&SHOW_ERROR("[SML] 문자열 구문이 아직 끝나지 않았습니다.",r),""===s?u+=n:(u+="'"===o?s+"\n":n+">"+s+"</"+o+">\n",o=void 0)}))):s+=n+"\n")};return EACH(n,function(t,i){"'"===t&&"\\"!==n[i-1]?r=r!==!0:r!==!0&&"\n"===t&&(a(n.substring(c,i)),c=i+1)}),r===!0?SHOW_ERROR("[SML] 문자열 구문이 아직 끝나지 않았습니다.",n.substring(c)):a(n.substring(c)),""!==s?void 0!==o?(u+=">\n"+t(s,i+1,e),REPEAT(i+e+1,function(){u+="\t"}),u+="</"+o+">\n",o=void 0):(u+=t(s,i+1,e-1),REPEAT(i+e-1,function(){u+="\t"})):void 0!==o&&"'"!==o&&(u+="meta"===o||"link"===o||"br"===o?">\n":"script"===o?"></script>\n":" />\n"),u};return{run:function(n){var i,e,o=n.indexOf("body");return"\n"!==n[o+5]||0!==o&&"\n"!==n[o-1]?(i=t(n,0,1),e=""):(i=t(n.substring(0,o),0,1),e=t(n.substring(o),0,0)),'<!doctype html>\n<html>\n\t<head>\n\t\t<meta charset="UTF-8">\n'+i+"\t</head>\n"+e+"</html>"}}}),global.LOAD_SML=METHOD(function(t){var n={};return{run:function(t,i){var e=i.notExists,o=i.error,r=i.success;GET_FILE_INFO(t,{notExists:e,success:function(i){var u=n[t];void 0!==u&&(void 0!==i.lastUpdateTime&&u.lastUpdateTime.getTime()===i.lastUpdateTime.getTime()||void 0!==i.createTime&&u.lastUpdateTime.getTime()===i.createTime.getTime())?r(u.html):READ_FILE(t,{notExists:e,error:o,success:function(e){var o=SML(e.toString());n[t]={lastUpdateTime:void 0===i.lastUpdateTime?i.createTime:i.lastUpdateTime,html:o},r(o)}})}})}}}),global.SML_BRIDGE=METHOD(function(t){var n=require("path"),i=function(t,n){t({statusCode:500,content:'<!doctype html><html><head><meta charset="UTF-8"><title>'+n+"</title></head><body>Error</body></html>",contentType:"text/html"})},e=function(t){t({statusCode:404,content:'<!doctype html><html><head><meta charset="UTF-8"><title>Page not found.</title></head><body><p><b>Page not found.</b></p></body></html>',contentType:"text/html"})};return{run:function(t){var o=t.rootPath;return{notExistsHandler:function(t,n,i){e(i)},requestListener:function(t,r,u,s){var c,a,m=t.uri,E=function(){LOAD_SML(c,{notExists:function(){e(r)},error:function(t){i(r,t)},success:function(t){r({content:t,contentType:"text/html"})}})};return NEXT([function(t){""===m?CHECK_FILE_EXISTS(o+"/index.sml",function(n){m=n===!0?"index.sml":"index.html",t()}):t()},function(){return function(){c=o+"/"+m,a=n.extname(m).toLowerCase(),".sml"===a?E():""===a?NEXT([function(t){CHECK_FILE_EXISTS(c+".sml",function(n){n===!0?CHECK_IS_FOLDER(c+".sml",function(n){n===!0?t():(c+=".sml",E())}):t()})},function(){return function(){CHECK_FILE_EXISTS(c,function(t){t===!0?CHECK_IS_FOLDER(c,function(t){t===!0?(c+="/index.sml",E()):s()}):s()})}}]):s()}}]),!1}}}}});